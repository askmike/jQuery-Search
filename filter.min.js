/* jQuery search plugin */
(function(a){a.fn.search=function(b){var c=[],d,e=false;if(typeof b==="string"){c=b.split(" ")}else if(typeof b==="array"){c=b}else if(typeof b==="object"){d=b}var f=a.extend({container:"#templates",single:".single",singleStructure:[{elem:"h3",score:3},{elem:"textarea",score:1}]},d);var g,h=this,i=[],j=[],k=[],l=[],m=a(f.container),n=m.find(f.single),o=function(){var b=f.singleStructure;for(var c=b.length,d=0;d<c;d++){l.push(b[d].score);i.push(b[d].elem)}n.detach().each(function(b){a(this).data("position",b);var c=[];for(var d=i.length,e=0;e<d;e++){c.push(n.eq(b).find(i[e]).text())}j.push({text:c,score:0})}).appendTo(m);s();e=true;g=j.length},p=function(b){q();var c=function(b,c){return a.inArray(b,c)<0};for(var d=b.length,e=0;e<d;e++){var f=b[e];for(var g=j.length,h=0;h<g;h++){var m=j[h],n=new RegExp("\\b"+f+"\\b","gi");for(var o=i.length,p=0;p<o;p++){if(n.test(m.text[p])){m.score+=l[p];if(c(h,k)){k.push(h)}}}}}var s=b.length;r(s)},q=function(){for(var a=j.length,b=0;b<a;b++){j[b].score=0}},r=function(b){function d(b,c){return a(b).data("position")>a(c).data("position")?1:-1}function c(b,c){return a(b).data("score")<a(c).data("score")?1:-1}g=0;n.detach().sort(d).each(function(c){var d=a(this);d.hide().data("score",j[c].score);if(a.inArray(c,k)!=-1&&b<=j[c].score){d.show();g++}});n.sort(c);m.append(n);n=m.find(f.single)},s=function(){h.keyup(function(a){if(h.val()==""){p([" "]);return}if(a.which==32){var b=[],c=h.val().split(" ");for(var d=0,e=c.length;d<e;d++){if(c[d]!=""){b.push(c[d])}}p(b)}})},t=function(a,b){p(a);if(!b&&a[0]!=" "){var c=a.join(" ")+" ";h.val(c)}};if(!e){o()}if(c.length){t(c)}return g}})(jQuery)
